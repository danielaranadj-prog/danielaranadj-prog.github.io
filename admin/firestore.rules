rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ==========================================
    // GLOBAL DEFAULT: Deny everything by default
    // ==========================================
    match /{document=**} {
      allow read, write: if false;
    }

    // ==========================================
    // INSTANTETRIPS BLOG & ANALYTICS RULES
    // ==========================================
    
    // Analytics Events: Deny all client-side writes. 
    match /analytics_events/{eventId} {
      allow read, write: if false; // LOCKED DOWN (Server-side only)
    }

    // Posts: Public read (for blog). Auth required for write (CMS/Editor)
    match /posts/{postId} {
        allow read: if true;
        allow write: if request.auth != null;
    }

    // ==========================================
    // ADMIN / EDITOR RULES (V2)
    // ==========================================

    // CONFIG PRINCIPAL (GitHub Token): Only Master Admin
    match /config/main {
      allow read, write: if request.auth != null 
        && request.auth.token.email == 'danielaranadj@gmail.com';
    }
    
    // AFFILIATES & TOURS: Public Read (for Sites), Admin Write
    match /config/affiliates {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.email == 'danielaranadj@gmail.com';
    }
    match /config/tours {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.email == 'danielaranadj@gmail.com';
    }
    
    // GENERIC CONFIG: Fallback for other config items (like /config/adsense used in blog)
    match /config/{configId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.email == 'danielaranadj@gmail.com';
    }
  }
}
